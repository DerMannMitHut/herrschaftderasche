items:
  small_key: {}
  map_fragment:
    state: unreadable
    states:
      unreadable: {}
      readable: {}
  ashen_crown: {}
  chest:
    state: closed
    states:
      closed: {}
      open: {}
      empty: {}

rooms:
  hut:
    items:
      - small_key
    exits:
      forest:
        duration: 5
  forest:
    exits:
      hut:
        duration: 5
      ash_village:
        duration: 10
  ruins:
    items:
      - chest
    exits:
      hut:
        duration: 20
  ash_village:
    items:
      - map_fragment
    exits:
      forest:
        duration: 10

npcs:
  villager:
    state: unknown
    states:
      unknown: {}
      met: {}
      helped: {}
    meet:
      location: ash_village
  ashram:
    state: unknown
    states:
      unknown: {}
      met: {}
      helped: {}
    meet:
      location: forest
      preconditions:
        npc_conditions:
          - npc: villager
            state: helped

actions:
  interpret_map:
    trigger: show
    item: map_fragment
    target_npc: ashram
    preconditions:
      npc_conditions:
        - npc: ashram
          state: helped
    effect:
      item_conditions:
        - item: map_fragment
          state: readable


  read_map:
    trigger: examine
    item: map_fragment
    preconditions:
      item_conditions:
        - item: map_fragment
          state: readable
    effect:
      add_exits:
        - room: hut
          target: ruins
          duration: 12

  open_chest:
    trigger: use
    item: small_key
    target_item: chest
    preconditions:
      is_location: ruins
    effect:
      item_conditions:
        - item: chest
          state: open

  find_crown:
    trigger: examine
    item: chest
    preconditions:
      item_conditions:
        - item: chest
          state: open
    effect:
      item_conditions:
        - item: chest
          state: empty
        - item: ashen_crown
          location: INVENTORY

start: hut
start_time: "08:00"

endings:
  crown_returned:
    preconditions:
      is_location: ash_village
      item_conditions:
        - item: ashen_crown
          location: INVENTORY
