items:
  small_key: {}
  map_fragment:
    state: unreadable
    states:
      unreadable: {}
      readable: {}
  ashen_crown: {}
  locked_chest:
    state: closed
    states:
      closed: {}
      open: {}

rooms:
  hut:
    items:
      - small_key
    exits:
      - forest
  forest:
    exits:
      - hut
      - ash_village
  ruins:
    items:
      - locked_chest
    exits:
      - forest
  ash_village:
    items:
      - map_fragment
    exits:
      - forest

npcs:
  villager:
    state: unknown
    states:
      unknown: {}
      met: {}
      helped: {}
    meet:
      location: ash_village
  ashram:
    state: unknown
    states:
      unknown: {}
      met: {}
      helped: {}
    meet:
      location: forest
      preconditions:
        npc_state:
          npc: villager
          state: helped

actions:
  interpret_map:
    trigger: show
    item: map_fragment
    target_npc: ashram
    preconditions:
      npc_condition:
        - npc: ashram
          state: helped
    effect:
      item_condition:
        - item: map_fragment
          state: readable
      add_exit:
        - room: hut
          target: ruins

  open_chest:
    trigger: use
    item: small_key
    target_item: locked_chest
    preconditions:
      is_location: ruins
    effect:
      item_condition:
        - item: locked_chest
          state: open

  find_crown:
    trigger: examine
    item: locked_chest
    precondition:
      item_conditions:
        - item: locked_chest
          state: open
    effect:
      item_conditions:
        - item: ashen_crown
          location: INVENTORY

start: hut

endings:
  crown_returned:
    preconditions:
      is_location: ash_village
      item_condition:
        item: ashen_crown
        location: INVENTORY
